<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…ÙÙŠØ¯Ø©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Ù…ÙƒØªØ¨Ø© QR Code -->
    <script src="https://cdn.jsdelivr.net/npm/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>
    <style>
        * {margin:0;padding:0;box-sizing:border-box; font-family: "Noto Kufi Arabic", sans-serif;}
        body {background:linear-gradient(135deg,#f5f7fa 0%,#e4e8f0 100%);color:#333;line-height:1.6;min-height:100vh;padding:20px;}
        .container {max-width:1200px;margin:0 auto;background:#fff;border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,0.1);padding:30px;}
        
        header{text-align:center;padding:30px 20px;background:linear-gradient(135deg,#2196f3 0%,#1976d2 100%);border-radius:15px;margin-bottom:30px;color:white;}
        h1{font-size:2.2rem;margin-bottom:10px;}
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            text-align: center;
        }
        .modal-content input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            text-align: center;
        }

        .controls{display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap;}
        .btn{padding:10px 20px;border:none;border-radius:5px;cursor:pointer;font-weight:600;transition:.3s;display:flex;align-items:center;gap:8px}
        .btn-primary{background:linear-gradient(to right,#2196f3,#1976d2);color:#fff;}
        .btn-success{background:linear-gradient(to right,#4caf50,#2e7d32);color:#fff;}
        .btn-info{background:linear-gradient(to right,#ff9800,#f57c00);color:#fff;}
        .btn-danger{background:linear-gradient(to right,#f44336,#d32f2f);color:#fff;}
        .btn-whatsapp{background:linear-gradient(to right,#25D366,#128C7E);color:#fff;}
        .btn-warning{background:linear-gradient(to right,#ffc107,#ff9800);color:#fff;}
        .btn:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(0,0,0,0.2);}
        
        .items-container{display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:20px;margin-top:20px;}
        .item-card{background:white;border-radius:15px;box-shadow:0 5px 15px rgba(0,0,0,0.08);border:1px solid #e0e0e0;padding:20px;text-align:center;}
        
        .qrcode-container {
            margin: 15px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px dashed #ddd;
            position: relative;
            min-height: 180px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .qrcode-wrapper {
            position: relative;
            display: inline-block;
        }
        
        .qrcode-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255,255,255,0.95);
            padding: 15px;
            border-radius: 8px;
            z-index: 10;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .item-actions{margin-top:15px;display:flex;gap:10px;justify-content:center;flex-wrap:wrap;}
        .search-box{flex:1;min-width:200px;padding:10px;border:1px solid #ccc;border-radius:8px;}
        footer{text-align:center;margin-top:40px;padding:20px;color:#7f8c8d;font-size:.9rem}
        
        .instructions {
            background: #e3f2fd;
            border-right: 4px solid #2196f3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            text-align: right;
        }
        
        .link-url {
            color: #3498db;
            word-break: break-all;
            font-size: 14px;
            margin: 10px 0;
            direction: ltr;
            text-align: center;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #e0e0e0;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .link-url:hover {
            background: #e3f2fd;
            border-color: #2196f3;
        }

        .link-title {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.3rem;
        }
        
        .names-container {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin: 25px auto;
            flex-wrap: wrap;
        }
        
        .name-circle {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 110px;
            height: 110px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            border: 3px solid white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            animation: pulse 2s infinite;
            transition: transform 0.3s ease;
        }
        
        .name-circle:hover {
            transform: scale(1.1);
        }
        
        .name-circle h2 {
            margin: 0;
            font-size: 1rem;
            font-weight: 600;
            text-align: center;
            line-height: 1.3;
        }
        
        /* ØªÙ…Ø§ÙŠØ² Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ù„Ù„Ø¯ÙˆØ§Ø¦Ø± */
        .name-circle:nth-child(1) {
            animation-delay: 0s;
            background: rgba(255, 255, 255, 0.25);
            border-color: #ffeb3b;
        }
        
        .name-circle:nth-child(2) {
            animation-delay: 0.5s;
            background: rgba(255, 255, 255, 0.25);
            border-color: #e91e63;
        }
        
        .name-circle:nth-child(3) {
            animation-delay: 1s;
            background: rgba(255, 255, 255, 0.25);
            border-color: #4caf50;
        }
        
        .name-circle:nth-child(4) {
            animation-delay: 1s;
            background: rgba(255, 255, 255, 0.25);
            border-color: #4caf50;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: #4caf50;
            color: white;
            border-radius: 5px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            z-index: 1001;
            display: none;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .link-status {
            font-size: 12px;
            margin-top: 5px;
            padding: 3px 8px;
            border-radius: 10px;
            display: inline-block;
        }
        
        .status-valid {
            background: #e8f5e8;
            color: #2e7d32;
        }
        
        .status-invalid {
            background: #ffebee;
            color: #c62828;
        }
        
        .status-fixed {
            background: #fff3e0;
            color: #ef6c00;
        }
        
        @media(max-width:768px){
            .items-container{grid-template-columns:1fr}
            .controls{flex-direction:column}
            .item-actions{flex-direction:column}
            .modal-content{width:95%;padding:20px;}
            .names-container{gap:15px;}
            .name-circle{width:90px;height:90px;}
        }
    </style>
</head>
<body>
    <div class="notification" id="notification"></div>
    
    <div class="container">
        <header>
            <h1><i class="fas fa-link"></i> Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…ÙÙŠØ¯Ø©</h1>
            <p>Ù‚Ù… Ø¨Ø¥Ø¯Ø§Ø±Ø© ÙˆÙ…Ø´Ø§Ø±ÙƒØ© Ø±ÙˆØ§Ø¨Ø·Ùƒ Ø§Ù„Ù…Ù‡Ù…Ø© Ù…Ø¹ Ø¨Ø§Ø±ÙƒÙˆØ¯ Ù„Ù„Ù…Ø³Ø­ Ø§Ù„Ø³Ø±ÙŠØ¹</p>
            <div class="names-container">
                <div class="name-circle">
                    <h2>Ù…Ø¤Ø³Ø³Ø© </h2>
                </div>
                <div class="name-circle">
                    <h2>ÙŠØ²Ù†</h2>
                </div>
                <div class="name-circle">
                    <h2>Ù„Ù„ØªØ¬Ù‡ÙŠØ²Ø§Øª</h2>
                </div>
                <div class="name-circle">
                    <h2>Ø§Ù„Ø¹Ù„Ù…ÙŠØ©</h2>
                </div>
            </div>
        </header>

        <!-- Ø±ÙˆØ§Ø¨Ø· -->
        <div id="links-tab">
            <div class="instructions">
                <h3><i class="fas fa-info-circle"></i> Ø­ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…:</h3>
                <p style="text-align: right;">ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø±ÙˆØ§Ø¨Ø· Ù…ÙÙŠØ¯Ø© ÙˆØ³ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø¨Ø§Ø±ÙƒÙˆØ¯ Ù„Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ù„Ù…Ø³Ø­ Ø§Ù„Ø³Ø±ÙŠØ¹. Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØ­ÙØ¸ ÙÙŠ Ù…ØªØµÙØ­Ùƒ.</p>
                <p style="text-align: right; color: #d32f2f; margin-top: 10px;">
                    <i class="fas fa-exclamation-triangle"></i>
                    Ø³ÙŠØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
                </p>
            </div>
            
            <div class="controls">
                <button class="btn btn-primary" onclick="showAddLinkModal()"><i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø· Ø¬Ø¯ÙŠØ¯</button>
                <button class="btn btn-success" onclick="exportLinks()"><i class="fas fa-download"></i> ØªØµØ¯ÙŠØ± Ø§Ù„Ø±ÙˆØ§Ø¨Ø·</button>
                <button class="btn btn-info" onclick="exportLinksAsJSON()"><i class="fas fa-file-export"></i> ØªØµØ¯ÙŠØ± JSON</button>
                <label class="btn btn-primary">
                    <i class="fas fa-file-import"></i> Ø§Ø³ØªÙŠØ±Ø§Ø¯ JSON
                    <input type="file" accept="application/json" onchange="importLinksFromJSON(event)" style="display:none;">
                </label>
                <button class="btn btn-whatsapp" onclick="shareAllLinks()"><i class="fab fa-whatsapp"></i> Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ÙƒÙ„</button>
                <button class="btn btn-warning" onclick="fixAllLinks()"><i class="fas fa-wrench"></i> Ø¥ØµÙ„Ø§Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·</button>
                <input type="text" class="search-box" id="searchLinkInput" placeholder="ğŸ” Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·" oninput="searchLinks()">
            </div>
            <div class="items-container" id="linksContainer"></div>
        </div>

        <footer>
            <p>Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© ÙÙŠ Ù…ØªØµÙØ­Ùƒ - ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</p>
        </footer>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø· -->
    <div class="modal" id="addLinkModal">
        <div class="modal-content">
            <h2><i class="fas fa-link"></i> Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø· Ø¬Ø¯ÙŠØ¯</h2>
            <input type="text" id="linkTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø§Ø¨Ø· (Ù…Ø«Ø§Ù„: Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø´Ø±ÙƒØ©)">
            <input type="url" id="linkUrl" placeholder="https://example.com">
            <div style="margin-top:20px;">
                <button class="btn btn-primary" onclick="addNewLink()"><i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ø±Ø§Ø¨Ø·</button>
                <button class="btn" onclick="hideAddLinkModal()" style="background:#ccc;">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

<script>
let links = [];
let activeQRCodes = new Map(); // Ù„ØªØ®Ø²ÙŠÙ† ÙˆØ¥Ø¯Ø§Ø±Ø© Ù†Ø³Ø® QR Code Ø§Ù„Ù†Ø´Ø·Ø©

// Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', () => {
    loadDataFromStorage();
    fixOldLinks(); // Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
    renderLinks();
});

// Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
function fixOldLinks() {
    let fixedCount = 0;
    
    links.forEach(link => {
        const originalUrl = link.url;
        const fixedUrl = fixURL(link.url);
        
        if (originalUrl !== fixedUrl) {
            link.url = fixedUrl;
            link.fixed = true; // ÙˆØ¶Ø¹ Ø¹Ù„Ø§Ù…Ø© Ø£Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ØªÙ… Ø¥ØµÙ„Ø§Ø­Ù‡
            fixedCount++;
        }
    });
    
    if (fixedCount > 0) {
        saveDataToStorage();
        showNotification(`ØªÙ… Ø¥ØµÙ„Ø§Ø­ ${fixedCount} Ø±Ø§Ø¨Ø· ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹`);
    }
}

// Ø¥ØµÙ„Ø§Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ÙŠØ¯ÙˆÙŠØ§Ù‹
function fixAllLinks() {
    let fixedCount = 0;
    
    links.forEach(link => {
        const originalUrl = link.url;
        const fixedUrl = fixURL(link.url);
        
        if (originalUrl !== fixedUrl) {
            link.url = fixedUrl;
            link.fixed = true;
            fixedCount++;
        }
    });
    
    if (fixedCount > 0) {
        saveDataToStorage();
        // Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ù…ÙŠØ¹ QR Codes Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­
        regenerateAllQRCodes();
        showNotification(`ØªÙ… Ø¥ØµÙ„Ø§Ø­ ${fixedCount} Ø±Ø§Ø¨Ø· ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯`);
    } else {
        showNotification('Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ØµØ§Ù„Ø­Ø© Ø¨Ø§Ù„ÙØ¹Ù„', 'info');
    }
}

// Ø¯Ø§Ù„Ø© Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
function fixURL(url) {
    if (!url) return '';
    
    // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ù† Ø§Ù„Ù…Ø³Ø§ÙØ§Øª
    let cleanUrl = url.trim();
    
    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ¨Ø¯Ø£ Ø¨Ù€ http:// Ø£Ùˆ https:// ÙÙ‡Ùˆ ØµØ§Ù„Ø­
    if (cleanUrl.startsWith('http://') || cleanUrl.startsWith('https://')) {
        return cleanUrl;
    }
    
    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ¨Ø¯Ø£ Ø¨Ù€ www. Ù†Ø¶ÙŠÙ https://
    if (cleanUrl.startsWith('www.')) {
        return 'https://' + cleanUrl;
    }
    
    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù†Ù‚Ø·Ø© (Ù†Ø·Ø§Ù‚) Ù†Ø¶ÙŠÙ https://
    if (cleanUrl.includes('.') && !cleanUrl.includes(' ')) {
        return 'https://' + cleanUrl;
    }
    
    // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø£ÙŠ Ù…Ù† Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©ØŒ Ù†Ø¹ÙŠØ¯ Ø§Ù„Ø±Ø§Ø¨Ø· ÙƒÙ…Ø§ Ù‡Ùˆ
    return cleanUrl;
}

// Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
function saveDataToStorage() {
    localStorage.setItem('usefulLinks', JSON.stringify(links));
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
function loadDataFromStorage() {
    const l = localStorage.getItem('usefulLinks');
    if (l) {
        try {
            links = JSON.parse(l);
            // Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ Ù„Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
            links.forEach(link => {
                if (!link.createdAt) {
                    link.createdAt = new Date().toISOString();
                }
            });
        } catch (e) {
            console.error('Error loading links:', e);
            links = [];
        }
    }
}

// Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
function showNotification(message, type = 'success') {
    const notification = document.getElementById('notification');
    notification.textContent = message;
    
    if (type === 'success') {
        notification.style.background = '#4caf50';
    } else if (type === 'error') {
        notification.style.background = '#f44336';
    } else if (type === 'info') {
        notification.style.background = '#2196f3';
    } else if (type === 'warning') {
        notification.style.background = '#ff9800';
    }
    
    notification.style.display = 'block';
    
    setTimeout(() => {
        notification.style.display = 'none';
    }, 3000);
}

// Ù…Ø³Ø­ QR Code Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù†
function clearQRCode(containerId) {
    const container = document.getElementById(containerId);
    if (!container) return;
    
    // Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
    container.innerHTML = '';
    
    // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ù†Ø³Ø®Ø© Ù…Ø®Ø²Ù†Ø© Ù…Ù† QR Code
    if (activeQRCodes.has(containerId)) {
        activeQRCodes.delete(containerId);
    }
}

// ØªÙˆÙ„ÙŠØ¯ QR Code Ø¬Ø¯ÙŠØ¯
function generateQRCode(containerId, data) {
    const container = document.getElementById(containerId);
    if (!container) return;

    try {
        // Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø£ÙˆÙ„Ø§Ù‹
        clearQRCode(containerId);
        
        // Ø¥Ø¶Ø§ÙØ© Ù…Ø¤Ø´Ø± ØªØ­Ù…ÙŠÙ„
        container.innerHTML = `
            <div class="qrcode-loading">
                <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 10px; display: block;"></i>
                <span>Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯...</span>
            </div>
        `;
        
        // Ø¥Ù†Ø´Ø§Ø¡ QR Code Ø¬Ø¯ÙŠØ¯ Ø¨Ø¹Ø¯ ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ·
        setTimeout(() => {
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ù„Ø§ ØªØ²Ø§Ù„ Ù…ÙˆØ¬ÙˆØ¯Ø©
            if (!document.getElementById(containerId)) return;
            
            // Ù…Ø³Ø­ Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
            container.innerHTML = '';
            
            const qrCode = new QRCodeStyling({
                width: 150,
                height: 150,
                data: data,
                dotsOptions: {
                    color: "#2196f3",
                    type: "rounded"
                },
                backgroundOptions: {
                    color: "#ffffff",
                },
                imageOptions: {
                    crossOrigin: "anonymous",
                    margin: 5
                }
            });
            
            // Ø¥Ù†Ø´Ø§Ø¡ QR Code
            qrCode.append(container);
            
            // Ø­ÙØ¸ Ø§Ù„Ù…Ø±Ø¬Ø¹ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠ
            activeQRCodes.set(containerId, qrCode);
            
        }, 100);
        
    } catch (error) {
        console.error('QR Code error:', error);
        container.innerHTML = `
            <div style="text-align:center; color:#666;">
                <i class="fas fa-exclamation-triangle" style="font-size:2rem; margin-bottom:10px; display:block;"></i>
                <small>Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</small>
                <br>
                <small style="font-size:10px;">${data}</small>
            </div>
        `;
    }
}

// Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ù…ÙŠØ¹ QR Codes
function regenerateAllQRCodes() {
    showNotification('Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯...', 'info');
    
    links.forEach((link, index) => {
        const fixedUrl = fixURL(link.url);
        const containerId = `link-qrcode-${link.id}`;
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ù†Ø´Ø§Ø¡ QR Code Ø¨Ø¹Ø¯ ØªØ£Ø®ÙŠØ± ØªØ¯Ø±ÙŠØ¬ÙŠ Ù„Ù…Ù†Ø¹ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø²Ø§Ø¦Ø¯
        setTimeout(() => {
            generateQRCode(containerId, fixedUrl);
        }, index * 200); // ØªØ£Ø®ÙŠØ± 200 Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ© Ø¨ÙŠÙ† ÙƒÙ„ Ø¨Ø§Ø±ÙƒÙˆØ¯
    });
    
    // Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø¹Ø¯ Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
    setTimeout(() => {
        showNotification('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­');
    }, (links.length * 200) + 500);
}

// ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø· ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø©
function openLink(url) {
    const fixedUrl = fixURL(url);
    window.open(fixedUrl, '_blank', 'noopener,noreferrer');
}

// Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©
function copyLink(url) {
    const fixedUrl = fixURL(url);
    navigator.clipboard.writeText(fixedUrl).then(() => {
        showNotification('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©!');
    }).catch(() => {
        // Ø¨Ø¯ÙŠÙ„ Ù„Ù„Ù…ØªØµÙØ­Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
        const textArea = document.createElement('textarea');
        textArea.value = fixedUrl;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        showNotification('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©!');
    });
}

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø±Ø§Ø¨Ø·
function isValidURL(string) {
    try {
        const url = new URL(string);
        return url.protocol === 'http:' || url.protocol === 'https:';
    } catch (_) {
        return false;
    }
}

// Ø¹Ø±Ø¶ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ù…Ø¹ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
function renderLinks() {
    const container = document.getElementById('linksContainer');
    if (links.length === 0) {
        container.innerHTML = `
            <div class="item-card" style="text-align:center;color:#666;grid-column:1/-1;">
                <i class="fas fa-link" style="font-size:4rem;margin-bottom:15px;color:#2196f3;"></i>
                <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±ÙˆØ§Ø¨Ø·</h3>
                <p>Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ "Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø· Ø¬Ø¯ÙŠØ¯" Ù„Ø¨Ø¯Ø¡ Ø¥Ø¶Ø§ÙØ© Ø±ÙˆØ§Ø¨Ø·Ùƒ Ø§Ù„Ù…Ù‡Ù…Ø©</p>
                <div style="margin-top:20px;">
                    <button class="btn btn-primary" onclick="showAddLinkModal()">
                        <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ø±Ø§Ø¨Ø·
                    </button>
                </div>
            </div>
        `;
        return;
    }
    
    container.innerHTML = links.map(link => {
        const fixedUrl = fixURL(link.url);
        const isValid = isValidURL(fixedUrl);
        const wasFixed = link.fixed || false;
        
        return `
        <div class="item-card">
            <h3 class="link-title">${link.title}</h3>
            
            <div class="link-url" title="${fixedUrl}" onclick="openLink('${link.url}')">
                <i class="fas fa-link"></i> 
                ${fixedUrl.length > 35 ? fixedUrl.substring(0, 35) + '...' : fixedUrl}
            </div>
            
            <div class="link-status ${isValid ? (wasFixed ? 'status-fixed' : 'status-valid') : 'status-invalid'}">
                <i class="fas ${isValid ? (wasFixed ? 'fa-wrench' : 'fa-check-circle') : 'fa-exclamation-triangle'}"></i>
                ${isValid ? (wasFixed ? 'ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø±Ø§Ø¨Ø·' : 'Ø±Ø§Ø¨Ø· ØµØ§Ù„Ø­') : 'Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ§Ù„Ø­'}
            </div>
            
            <!-- Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ø±Ø§Ø¨Ø· -->
            <div class="qrcode-container">
                <div id="link-qrcode-${link.id}"></div>
            </div>
            
            <div class="item-actions">
                <button class="btn btn-whatsapp" onclick="shareSingleLink('${link.title}', '${link.url}')">
                    <i class="fab fa-whatsapp"></i> Ù…Ø´Ø§Ø±ÙƒØ©
                </button>
                <button class="btn btn-success" onclick="downloadQRCode('${link.id}', '${link.title}')">
                    <i class="fas fa-download"></i> Ø­ÙØ¸ QR
                </button>
                <button class="btn btn-info" onclick="copyLink('${link.url}')">
                    <i class="fas fa-copy"></i> Ù†Ø³Ø®
                </button>
                <button class="btn btn-danger" onclick="deleteLink(${link.id})">
                    <i class="fas fa-trash"></i> Ø­Ø°Ù
                </button>
            </div>
        </div>
    `}).join('');
    
    // ØªÙˆÙ„ÙŠØ¯ QR Codes Ø¨Ø¹Ø¯ Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù†Ø§ØµØ±
    setTimeout(() => {
        regenerateAllQRCodes();
    }, 500);
}

// ØªØ­Ù…ÙŠÙ„ QR Code ÙƒØµÙˆØ±Ø©
function downloadQRCode(id, title) {
    const container = document.getElementById(`link-qrcode-${id}`);
    if (container && container.querySelector('canvas')) {
        const canvas = container.querySelector('canvas');
        const link = document.createElement('a');
        link.download = `Ø¨Ø§Ø±ÙƒÙˆØ¯_${title.replace(/\s+/g, '_')}.png`;
        link.href = canvas.toDataURL();
        link.click();
        showNotification('ØªÙ… ØªØ­Ù…ÙŠÙ„ QR Code Ø¨Ù†Ø¬Ø§Ø­!');
    } else {
        showNotification('QR Code ØºÙŠØ± Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ­Ù…ÙŠÙ„', 'error');
    }
}

// Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø±Ø§Ø¨Ø· Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
function shareSingleLink(title, url) {
    const fixedUrl = fixURL(url);
    const message = `ğŸ”— ${title}\n${fixedUrl}`;
    const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
    window.open(whatsappUrl, '_blank');
}

// Ù…Ø´Ø§Ø±ÙƒØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
function shareAllLinks() {
    if (links.length === 0) {
        showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±ÙˆØ§Ø¨Ø· Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©', 'error');
        return;
    }
    
    let message = "ğŸ“‹ Ø±ÙˆØ§Ø¨Ø·ÙŠ Ø§Ù„Ù…ÙÙŠØ¯Ø©:\n\n";
    links.forEach((link, index) => {
        const fixedUrl = fixURL(link.url);
        message += `${index + 1}. ${link.title}\n${fixedUrl}\n\n`;
    });
    
    const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
    window.open(whatsappUrl, '_blank');
}

// Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¹Ø±Ø¶ ÙˆØ§Ù„Ø¥Ø®ÙØ§Ø¡ Ù„Ù„Ù†Ù…Ø§Ø°Ø¬
function showAddLinkModal() { 
    document.getElementById('addLinkModal').style.display = 'flex'; 
}

function hideAddLinkModal() { 
    document.getElementById('addLinkModal').style.display = 'none'; 
    document.getElementById('linkTitle').value = '';
    document.getElementById('linkUrl').value = '';
}

// Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø· Ø¬Ø¯ÙŠØ¯
function addNewLink() {
    const title = document.getElementById('linkTitle').value.trim();
    const url = document.getElementById('linkUrl').value.trim();
    
    if (!title) {
        showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ù„Ù„Ø±Ø§Ø¨Ø·', 'error');
        return;
    }
    
    if (!url) {
        showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ø§Ø¨Ø·', 'error');
        return;
    }
    
    // Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø±Ø§Ø¨Ø· ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
    const finalUrl = fixURL(url);
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø±Ø§Ø¨Ø·
    if (!isValidURL(finalUrl)) {
        showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· ØµØ­ÙŠØ­', 'error');
        return;
    }
    
    const link = {
        id: Date.now(),
        title: title,
        url: finalUrl,
        createdAt: new Date().toISOString()
    };
    
    links.push(link);
    saveDataToStorage();
    renderLinks();
    hideAddLinkModal();
    
    showNotification('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ù†Ø¬Ø§Ø­!');
}

function deleteLink(id) {
    if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø·ØŸ')) {
        // Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ù…Ø±ØªØ¨Ø· Ù‚Ø¨Ù„ Ø§Ù„Ø­Ø°Ù
        const containerId = `link-qrcode-${id}`;
        clearQRCode(containerId);
        
        links = links.filter(l => l.id !== id);
        saveDataToStorage();
        renderLinks();
        showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ù†Ø¬Ø§Ø­');
    }
}

// Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
function searchLinks() {
    const query = document.getElementById('searchLinkInput').value.toLowerCase();
    const container = document.getElementById('linksContainer');
    const filteredLinks = links.filter(l => 
        l.title.toLowerCase().includes(query) || l.url.toLowerCase().includes(query)
    );
    
    if (filteredLinks.length === 0) {
        container.innerHTML = `
            <div class="item-card" style="text-align:center;color:#666;grid-column:1/-1;">
                <i class="fas fa-search" style="font-size:3rem;margin-bottom:15px;"></i>
                <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</h3>
                <p>Ø¬Ø±Ø¨ ÙƒÙ„Ù…Ø§Øª Ø¨Ø­Ø« Ø£Ø®Ø±Ù‰</p>
            </div>
        `;
        return;
    }
    
    container.innerHTML = filteredLinks.map(link => {
        const fixedUrl = fixURL(link.url);
        const isValid = isValidURL(fixedUrl);
        const wasFixed = link.fixed || false;
        
        return `
        <div class="item-card">
            <h3 class="link-title">${link.title}</h3>
            
            <div class="link-url" title="${fixedUrl}" onclick="openLink('${link.url}')">
                <i class="fas fa-link"></i> 
                ${fixedUrl.length > 35 ? fixedUrl.substring(0, 35) + '...' : fixedUrl}
            </div>
            
            <div class="link-status ${isValid ? (wasFixed ? 'status-fixed' : 'status-valid') : 'status-invalid'}">
                <i class="fas ${isValid ? (wasFixed ? 'fa-wrench' : 'fa-check-circle') : 'fa-exclamation-triangle'}"></i>
                ${isValid ? (wasFixed ? 'ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø±Ø§Ø¨Ø·' : 'Ø±Ø§Ø¨Ø· ØµØ§Ù„Ø­') : 'Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ§Ù„Ø­'}
            </div>
            
            <div class="qrcode-container">
                <div id="link-qrcode-${link.id}"></div>
            </div>
            
            <div class="item-actions">
                <button class="btn btn-whatsapp" onclick="shareSingleLink('${link.title}', '${link.url}')">
                    <i class="fab fa-whatsapp"></i> Ù…Ø´Ø§Ø±ÙƒØ©
                </button>
                <button class="btn btn-success" onclick="downloadQRCode('${link.id}', '${link.title}')">
                    <i class="fas fa-download"></i> Ø­ÙØ¸ QR
                </button>
                <button class="btn btn-info" onclick="copyLink('${link.url}')">
                    <i class="fas fa-copy"></i> Ù†Ø³Ø®
                </button>
                <button class="btn btn-danger" onclick="deleteLink(${link.id})">
                    <i class="fas fa-trash"></i> Ø­Ø°Ù
                </button>
            </div>
        </div>
    `}).join('');
    
    setTimeout(() => {
        filteredLinks.forEach(link => {
            const fixedUrl = fixURL(link.url);
            generateQRCode(`link-qrcode-${link.id}`, fixedUrl);
        });
    }, 300);
}

// Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØµØ¯ÙŠØ± ÙˆØ§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯
function exportLinksAsJSON() {
    if (links.length === 0) {
        showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±ÙˆØ§Ø¨Ø· Ù„Ù„ØªØµØ¯ÙŠØ±', 'error');
        return;
    }
    
    const json = JSON.stringify(links, null, 2);
    downloadFile(json, 'Ø±ÙˆØ§Ø¨Ø·-Ù…ÙÙŠØ¯Ø©.json', 'application/json');
    showNotification('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø¨Ù†Ø¬Ø§Ø­');
}

function importLinksFromJSON(event) {
    const file = event.target.files[0]; 
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = e => {
        try {
            const data = JSON.parse(e.target.result);
            if (Array.isArray(data)) {
                // Ø¯Ù…Ø¬ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù…Ø¹ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
                const existingIds = new Set(links.map(l => l.id));
                const newLinks = data.filter(link => !existingIds.has(link.id));
                
                links = [...links, ...newLinks];
                saveDataToStorage();
                fixOldLinks(); // Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø©
                renderLinks();
                showNotification(`âœ… ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${newLinks.length} Ø±Ø§Ø¨Ø· Ø¬Ø¯ÙŠØ¯`);
            } else {
                showNotification("âŒ Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­", 'error');
            }
        } catch (e) { 
            showNotification("âŒ Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­", 'error');
        }
    };
    reader.readAsText(file);
}

function exportLinks() {
    if (links.length === 0) {
        showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±ÙˆØ§Ø¨Ø· Ù„Ù„ØªØµØ¯ÙŠØ±', 'error');
        return;
    }
    
    let txt = "Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…ÙÙŠØ¯Ø©:\n\n";
    links.forEach((l, index) => { 
        const fixedUrl = fixURL(l.url);
        txt += `${index + 1}. ${l.title}\n${fixedUrl}\n\n`; 
    });
    downloadFile(txt, 'Ø±ÙˆØ§Ø¨Ø·-Ù…ÙÙŠØ¯Ø©.txt', 'text/plain');
    showNotification('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø¨Ù†Ø¬Ø§Ø­');
}

function downloadFile(content, fileName, type) {
    const blob = new Blob([content], { type });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = fileName;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}
</script>
</body>
</html>